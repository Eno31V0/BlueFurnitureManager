<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ãƒ–ãƒ«ã‚¢ã‚« ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³å®¶å…·ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: #1a1b2e; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="master-data.js"></script>
  <script type="text/babel">
const { useState, useEffect, useMemo, useCallback } = React;
// ========== Storage ==========
const SK = "ba-mgr-v5";
const initState = (prev) => ({
  version: 5,
  students: Object.fromEntries(INIT_STUDENTS.map(s => {
    const p = prev?.students?.[s.id];
    return [s.id, { owned: p?.owned ?? false, star: p?.star ?? s.star, bond: p?.bond ?? 1, hasEx: p?.hasEx ?? s.hasEx }];
  })),
  furniture: Object.fromEntries(INIT_FURNITURE.map(f => {
    const p = prev?.furniture?.[f.id];
    return [f.id, { owned: p?.owned ?? false, room: p?.room ?? 0 }];
  })),
  furnitureOrder: prev?.furnitureOrder || INIT_FURNITURE.map(f => f.id),
  customStudents: prev?.customStudents || [],
  customFurniture: prev?.customFurniture || [],
  masterEdits: prev?.masterEdits || { furniture: {}, students: {}, series: {} },
});

// ========== Styles ==========
const C = { bg:"#1a1b2e",card:"#252742",accent:"#4fc3f7",accentDim:"#2a6f8a",gold:"#ffd54f",text:"#e8eaf6",textDim:"#9e9eaf",border:"#3a3c5a",owned:"#2e7d32",room1:"#e65100",room2:"#6a1b9a",roomBoth:"#1565c0",danger:"#ef5350",catFurn:"#4a6741",catDeco:"#6a4176",amber:"#ffb74d",purple:"#ce93d8" };
const isInRoom = (r, t) => r === 3 || r === t;
const roomColor = (r) => r===3?C.roomBoth:r===2?C.room2:r===1?C.room1:C.border;
const roomLabel = (r) => r===3?"R1&R2":r===2?"R2":r===1?"R1":"æœªè¨­ç½®";
const btn = (on, color) => ({ padding:"5px 10px",border:"none",borderRadius:6,cursor:"pointer",fontSize:11,fontWeight:600,background:on?(color||C.accent):C.card,color:on?"#000":C.textDim,transition:"all .2s",whiteSpace:"nowrap" });

function App() {
  const [state, setState] = useState(() => initState());
  const [loaded, setLoaded] = useState(false);
  const [tab, setTab] = useState(0);
  const [search, setSearch] = useState("");
  const [furniCat, setFurniCat] = useState("all");
  const [furniType, setFurniType] = useState("all");
  const [furniSort, setFurniSort] = useState("user");
  const [studentSort, setStudentSort] = useState("name-asc");
  const [bondFilter, setBondFilter] = useState("all");
  const [motionFilter, setMotionFilter] = useState("all");
  const [dragId, setDragId] = useState(null);
  const [roomMode, setRoomMode] = useState("room");
  const [roomSearch, setRoomSearch] = useState("");
  const [showIO, setShowIO] = useState(false);
  const [importText, setImportText] = useState("");
  const [confirmReset, setConfirmReset] = useState(false);
  const [addMode, setAddMode] = useState(null);
  const [addForm, setAddForm] = useState({});
  const [editMode, setEditMode] = useState(false);
  const [stateBackup, setStateBackup] = useState(null);
  const [hlScope, setHlScope] = useState("all");
  const [hlThreshold, setHlThreshold] = useState("cap");
  const [editFurnId, setEditFurnId] = useState(null);
  const [editStudentId, setEditStudentId] = useState(null);
  const [editDraft, setEditDraft] = useState({});

  // Load from localStorage
  useEffect(() => {
    try {
      const raw = localStorage.getItem(SK);
      if (raw) {
        const d = JSON.parse(raw);
        setState(initState(d));
      }
    } catch {}
    setLoaded(true);
  }, []);

  // Save to localStorage â€” suppress in editMode (manual save on exit)
  const saveNow = useCallback(() => { try { localStorage.setItem(SK, JSON.stringify(state)); } catch {} }, [state]);
  useEffect(() => { if (!loaded || editMode) return; saveNow(); }, [state, loaded, editMode, saveNow]);

  const enterEdit = () => { setStateBackup(JSON.parse(JSON.stringify(state))); setEditMode(true); setEditFurnId(null); setEditStudentId(null); };
  const saveEdit = () => { setEditMode(false); setStateBackup(null); setEditFurnId(null); setEditStudentId(null); };
  const cancelEdit = () => { if(stateBackup) setState(stateBackup); setEditMode(false); setStateBackup(null); setEditFurnId(null); setEditStudentId(null); };

  // Master data edit helpers
  const startEditFurn = (f) => {
    setEditFurnId(f.id); setEditStudentId(null);
    setEditDraft({ name: eFurnName(f), series: eFurnSeries(f), targets: eFurnTargets(f).map(sid=>eStudentName(allStudentMap[sid]||{name:sid})).join(", ") });
  };
  const applyEditFurn = (fid) => {
    const targetIds = editDraft.targets.split(",").map(s=>s.trim()).filter(Boolean).map(tname=>allStudents.find(s=>eStudentName(s)===tname)?.id).filter(Boolean);
    setState(prev => ({...prev, masterEdits: {...(prev.masterEdits||{}), furniture:{...(prev.masterEdits?.furniture||{}), [fid]:{name:editDraft.name.trim(), targets:targetIds}}, series:{...(prev.masterEdits?.series||{}), [editDraft.name.trim()]:editDraft.series.trim()} }}));
    setEditFurnId(null);
  };
  const startEditStudent = (s) => {
    setEditStudentId(s.id); setEditFurnId(null);
    setEditDraft({ name: eStudentName(s) });
  };
  const applyEditStudent = (sid) => {
    setState(prev => ({...prev, masterEdits: {...(prev.masterEdits||{}), students:{...(prev.masterEdits?.students||{}), [sid]:{name:editDraft.name.trim()}} }}));
    setEditStudentId(null);
  };

  const upd = useCallback((path, val) => setState(prev => {
    const n = JSON.parse(JSON.stringify(prev)); const k = path.split("."); let o = n;
    for (let i = 0; i < k.length - 1; i++) o = o[k[i]]; o[k[k.length - 1]] = val; return n;
  }), []);

  // ---- Helpers ----
  const gss = useCallback((sid) => state.students[sid] || { owned:false, star:STUDENT_MAP[sid]?.star||3, bond:1, hasEx:STUDENT_MAP[sid]?.hasEx||false }, [state.students]);
  const gfs = useCallback((fid) => state.furniture[fid] || { owned:false, room:0 }, [state.furniture]);
  const tso = (sid) => { const c=gss(sid); upd(`students.${sid}`,{...c,owned:!c.owned}); };
  const ssr = (sid,star) => { const c=gss(sid); upd(`students.${sid}`,{...c,star,bond:Math.min(c.bond,getBondCap(star))}); };
  const ssb = (sid,bond) => { const c=gss(sid); upd(`students.${sid}`,{...c,bond:Math.max(1,Math.min(bond,getBondCap(c.star)))}); };
  const tex = (sid) => { const c=gss(sid); upd(`students.${sid}`,{...c,hasEx:!c.hasEx}); };
  const tfo = (fid) => { const c=gfs(fid); upd(`furniture.${fid}`,{...c,owned:!c.owned}); };
  const sfr = (fid,r) => { const c=gfs(fid); upd(`furniture.${fid}`,{...c,room:r}); };
  const toggleRoom = (fid,tr) => { const r=gfs(fid).room; sfr(fid,r===3?(tr===1?2:1):r===tr?0:r===0?tr:3); };

  const allStudents = useMemo(() => [...INIT_STUDENTS, ...(state.customStudents||[])], [state.customStudents]);
  const allFurniture = useMemo(() => [...INIT_FURNITURE, ...(state.customFurniture||[])], [state.customFurniture]);
  const allStudentMap = useMemo(() => Object.fromEntries(allStudents.map(s=>[s.id,s])), [allStudents]);
  const allFurnMap = useMemo(() => Object.fromEntries(allFurniture.map(f=>[f.id,f])), [allFurniture]);

  // Effective name/targets with masterEdits overlay
  const me = state.masterEdits || { furniture:{}, students:{}, series:{} };
  const eFurnName = (f) => me.furniture?.[f.id]?.name || f.name;
  const eFurnTargets = (f) => me.furniture?.[f.id]?.targets || f.targets;
  const eFurnSeries = (f) => { const n=eFurnName(f); return me.series?.[n] ?? (SERIES_MAP[n] || SERIES_MAP[f.name] || ""); };
  const eStudentName = (s) => me.students?.[s.id]?.name || s.name;

  // Students targeted by any motion furniture (using effective targets)
  const motionStudentIds = useMemo(() => { const s=new Set(); allFurniture.forEach(f=>(me.furniture?.[f.id]?.targets||f.targets).forEach(sid=>s.add(sid))); return s; }, [allFurniture, me.furniture]);

  // Highlight: configurable scope and threshold for room tab
  const furnHighlight = (f) => {
    const targets = eFurnTargets(f);
    if(targets.length===0) return false;
    const ot = targets.filter(sid=>gss(sid).owned);
    if(ot.length===0) return false;
    const check = (sid) => {
      const s=gss(sid);
      if(hlThreshold==="cap") return s.bond>=getBondCap(s.star);
      return s.hasEx ? s.bond>=20 : s.bond>=9;
    };
    return hlScope==="all" ? ot.every(check) : ot.some(check);
  };

  // Sorted/filtered furniture
  const eSeriesIdx = (f) => { const s=eFurnSeries(f)||"ãã®ä»–"; const i=SERIES_ORDER.indexOf(s); return i>=0?i:0; };
  const filteredFurniture = useMemo(() => {
    const order = state.furnitureOrder || allFurniture.map(f=>f.id);
    let list = order.filter(id=>allFurnMap[id]).map(id=>allFurnMap[id]);
    if (furniCat !== "all") list = list.filter(f=>f.cat===furniCat);
    if (furniType !== "all") list = list.filter(f=>f.type===furniType);
    if (search) { const q=search.toLowerCase(); list=list.filter(f=>eFurnName(f).toLowerCase().includes(q)||eFurnTargets(f).some(sid=>(eStudentName(allStudentMap[sid]||{name:sid})).toLowerCase().includes(q))); }
    if (furniSort === "name") list = [...list].sort((a,b)=>eFurnName(a).localeCompare(eFurnName(b),"ja"));
    else if (furniSort === "series") list = [...list].sort((a,b)=>eSeriesIdx(a)-eSeriesIdx(b)||eFurnName(a).localeCompare(eFurnName(b),"ja"));
    return list;
  }, [furniCat, furniType, search, furniSort, state.furnitureOrder, allFurniture, allFurnMap, allStudentMap, me]);

  // Sorted/filtered students for bond tab
  const sortedStudents = useMemo(() => {
    let list = [...allStudents];
    if (search) { const q=search.toLowerCase(); list=list.filter(s=>eStudentName(s).toLowerCase().includes(q)); }
    if (bondFilter === "owned") list = list.filter(s=>gss(s.id).owned);
    else if (bondFilter === "notOwned") list = list.filter(s=>!gss(s.id).owned);
    if (motionFilter === "hasMotion") list = list.filter(s=>motionStudentIds.has(s.id));
    else if (motionFilter === "noMotion") list = list.filter(s=>!motionStudentIds.has(s.id));
    const [key,dir] = studentSort.split("-");
    list.sort((a,b)=>{ if(key==="name"){const c=eStudentName(a).localeCompare(eStudentName(b),"ja");return dir==="asc"?c:-c;} const sa=gss(a.id).star,sb=gss(b.id).star; if(sa!==sb)return dir==="asc"?sa-sb:sb-sa; return eStudentName(a).localeCompare(eStudentName(b),"ja"); });
    return list;
  }, [search, studentSort, bondFilter, motionFilter, state.students, allStudents, motionStudentIds, me]);

  // Stats
  const stats = useMemo(() => {
    const of=allFurniture.filter(f=>gfs(f.id).owned).length;
    const r1=allFurniture.filter(f=>{const r=gfs(f.id).room;return r===1||r===3;}).length;
    const r2=allFurniture.filter(f=>{const r=gfs(f.id).room;return r===2||r===3;}).length;
    return {of,r1,r2,tf:allFurniture.length};
  }, [state.furniture, allFurniture]);

  // Add custom student/furniture
  const addCustomStudent = () => {
    const name = addForm.name?.trim();
    if (!name) return;
    const id = "cs_" + Date.now();
    setState(prev => ({
      ...prev,
      customStudents: [...(prev.customStudents||[]), {id,name,star:Number(addForm.star)||3,hasEx:!!addForm.hasEx}],
      students: {...prev.students, [id]:{owned:false,star:Number(addForm.star)||3,bond:1,hasEx:!!addForm.hasEx}}
    }));
    setAddForm({}); setAddMode(null);
  };
  const addCustomFurniture = () => {
    const name = addForm.name?.trim();
    if (!name) return;
    const id = "cf_" + Date.now();
    const targets = (addForm.targets||"").split(",").map(s=>s.trim()).filter(Boolean);
    const targetIds = targets.map(tname => allStudents.find(s=>s.name===tname)?.id).filter(Boolean);
    setState(prev => ({
      ...prev,
      customFurniture: [...(prev.customFurniture||[]), {id,name,type:addForm.type||"å°ç‰©",cat:addForm.cat||"furniture",targets:targetIds}],
      furniture: {...prev.furniture, [id]:{owned:false,room:0}},
      furnitureOrder: [...(prev.furnitureOrder||[]),id]
    }));
    setAddForm({}); setAddMode(null);
  };
  const deleteCustomStudent = (id) => setState(prev => ({...prev, customStudents:(prev.customStudents||[]).filter(s=>s.id!==id)}));
  const deleteCustomFurniture = (id) => setState(prev => ({...prev, customFurniture:(prev.customFurniture||[]).filter(f=>f.id!==id), furnitureOrder:(prev.furnitureOrder||[]).filter(fid=>fid!==id)}));

  const exportJson = useMemo(() => showIO ? JSON.stringify(state,null,2) : "", [showIO,state]);
  const doImport = () => { try { const d=JSON.parse(importText); if(d.students&&d.furniture){setState(initState(d));setImportText("");setShowIO(false);}else{alert("ç„¡åŠ¹ãªãƒ‡ãƒ¼ã‚¿");}} catch{alert("JSONå½¢å¼ã‚¨ãƒ©ãƒ¼");} };
  const doReset = () => { const f=initState(); setState(f); try{localStorage.setItem(SK,JSON.stringify(f));}catch{} setConfirmReset(false); };

  const tabs = ["æ‰€æŒçŠ¶æ³","ãƒ«ãƒ¼ãƒ è¨­ç½®","çµ†ãƒ©ãƒ³ã‚¯","ãƒ‡ãƒ¼ã‚¿ç®¡ç†"];
  const sortOpts = [{v:"name-asc",l:"åå‰â†‘"},{v:"name-desc",l:"åå‰â†“"},{v:"star-asc",l:"â˜…â†‘"},{v:"star-desc",l:"â˜…â†“"}];

  // Drag handlers
  const onDS = (fid) => setDragId(fid);
  const onDO = (e) => e.preventDefault();
  const onDE = () => setDragId(null);
  const onDrop = (tid) => { if(!dragId){return;} if(dragId===tid){setDragId(null);return;} setState(prev=>{const o=[...(prev.furnitureOrder||allFurniture.map(f=>f.id))];const fi=o.indexOf(dragId),ti=o.indexOf(tid);if(fi<0||ti<0)return prev;o.splice(fi,1);o.splice(ti,0,dragId);return{...prev,furnitureOrder:o};}); setDragId(null); };

  // Room search filter
  const roomSearchFilter = (f) => {
    if (!roomSearch) return true;
    const q = roomSearch.toLowerCase();
    return eFurnName(f).toLowerCase().includes(q) || eFurnTargets(f).some(sid=>(eStudentName(allStudentMap[sid]||{name:""}) ).toLowerCase().includes(q));
  };

  // Furniture card for room tab
  const FurnRoomCard = ({f, border, showSelect}) => {
    const fs = gfs(f.id);
    const hl = furnHighlight(f);
    const tNames = eFurnTargets(f).map(sid => { const ss=gss(sid); const sd=allStudentMap[sid]; return sd?`${eStudentName(sd)}(â˜…${ss.star} çµ†${ss.bond})`:"?"; }).join(", ");
    const hlBg = hl ? `${C.gold}22` : C.card;
    const hlBorder = hl ? C.gold : border;
    return (
      <div style={{background:hlBg,borderRadius:8,padding:"6px 10px",marginBottom:3,border:`2px solid ${hlBorder}`,boxShadow:hl?`0 0 8px ${C.gold}44`:"none"}}>
        <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
          <div style={{flex:1,minWidth:0}}>
            <div style={{fontSize:12,fontWeight:600}}>{eFurnName(f)} {fs.room===3&&<span style={{fontSize:9,background:C.roomBoth,color:"#fff",padding:"1px 4px",borderRadius:3,marginLeft:4}}>ä¸¡æ–¹</span>}</div>
            <div style={{fontSize:10,color:hl?C.gold:C.textDim}}>{tNames}</div>
          </div>
          {showSelect && <select value={fs.room} onChange={e=>sfr(f.id,Number(e.target.value))} style={{background:C.card,color:C.text,border:`1px solid ${C.border}`,borderRadius:4,padding:"3px 5px",fontSize:11}}>
            <option value={0}>æœªè¨­ç½®</option><option value={1}>ãƒ«ãƒ¼ãƒ 1</option><option value={2}>ãƒ«ãƒ¼ãƒ 2</option><option value={3}>ä¸¡æ–¹(1&2)</option>
          </select>}
        </div>
      </div>
    );
  };

  if (!loaded) return <div style={{background:C.bg,minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",color:C.textDim}}>èª­ã¿è¾¼ã¿ä¸­...</div>;

  return (
    <div style={{background:C.bg,minHeight:"100vh",color:C.text,fontFamily:"'Segoe UI',sans-serif",maxWidth:900,margin:"0 auto",padding:"8px 12px"}}>
      <h2 style={{textAlign:"center",margin:"8px 0",fontSize:18,background:"linear-gradient(135deg,#4fc3f7,#7c4dff)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"}}>ãƒ–ãƒ«ã‚¢ã‚« ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³å®¶å…·ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼</h2>
      <div style={{textAlign:"center",fontSize:11,color:C.textDim,marginBottom:8}}>å®¶å…· {stats.of}/{stats.tf} | R1:{stats.r1} R2:{stats.r2} | ç”Ÿå¾’ {allStudents.length}å</div>

      <div style={{display:"flex",gap:4,marginBottom:8}}>{tabs.map((t,i)=><button key={i} onClick={()=>{if(editMode){if(!confirm("ç·¨é›†ä¸­ã§ã™ã€‚å¤‰æ›´ã‚’ç ´æ£„ã—ã¦ã‚¿ãƒ–ã‚’åˆ‡ã‚Šæ›¿ãˆã¾ã™ã‹ï¼Ÿ")){return;}cancelEdit();}setTab(i);}} style={{flex:1,padding:"8px 0",border:"none",borderRadius:6,cursor:"pointer",fontSize:13,fontWeight:600,background:tab===i?C.accent:C.card,color:tab===i?"#000":C.textDim}}>{t}</button>)}</div>

      {editMode && <div style={{background:"#ff980033",border:"1px solid #ff9800",borderRadius:6,padding:"6px 12px",marginBottom:8,display:"flex",alignItems:"center",justifyContent:"space-between"}}>
        <span style={{fontSize:12,fontWeight:600,color:"#ffb74d"}}>ğŸ“ ç·¨é›†ãƒ¢ãƒ¼ãƒ‰</span>
        <div style={{display:"flex",gap:4}}>
          <button onClick={saveEdit} style={{padding:"4px 10px",border:"none",borderRadius:4,background:"#66bb6a",color:"#000",fontSize:11,fontWeight:700,cursor:"pointer"}}>ğŸ’¾ ä¿å­˜</button>
          <button onClick={cancelEdit} style={{padding:"4px 10px",border:"none",borderRadius:4,background:C.danger,color:"#fff",fontSize:11,fontWeight:600,cursor:"pointer"}}>âœ• å–æ¶ˆ</button>
        </div>
      </div>}

      {tab<3 && <input value={tab===1?roomSearch:search} onChange={e=>tab===1?setRoomSearch(e.target.value):setSearch(e.target.value)} placeholder="æ¤œç´¢(å®¶å…·åãƒ»ç”Ÿå¾’å)..." style={{width:"100%",padding:"8px 12px",boxSizing:"border-box",borderRadius:6,border:`1px solid ${C.border}`,background:C.card,color:C.text,fontSize:13,marginBottom:8,outline:"none"}} />}

      {/* ===== Tab 0: æ‰€æŒçŠ¶æ³ ===== */}
      {tab===0 && <div>
        {/* Category filter */}
        <div style={{display:"flex",gap:4,marginBottom:4}}>
          {[["all",`å…¨ã¦(${allFurniture.length})`],["furniture",`å®¶å…·(${allFurniture.filter(f=>f.cat==="furniture").length})`],["decoration",`è£…é£¾(${allFurniture.filter(f=>f.cat==="decoration").length})`]].map(([k,l])=>
            <button key={k} onClick={()=>setFurniCat(k)} style={btn(furniCat===k,k==="furniture"?C.catFurn:k==="decoration"?C.catDeco:C.accentDim)}>{l}</button>
          )}
        </div>
        {/* Type filter */}
        <div style={{display:"flex",gap:3,marginBottom:4,flexWrap:"wrap"}}>
          <button onClick={()=>setFurniType("all")} style={btn(furniType==="all")}>ç¨®åˆ¥:å…¨ã¦</button>
          {FURN_TYPES.map(t=><button key={t} onClick={()=>setFurniType(t)} style={btn(furniType===t)}>{t}</button>)}
        </div>
        {/* Sort */}
        <div style={{display:"flex",gap:3,marginBottom:6,alignItems:"center",flexWrap:"wrap"}}>
          <span style={{fontSize:10,color:C.textDim}}>ä¸¦æ›¿:</span>
          {[["user","ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®š"],["name","åå‰"],["series","ã‚»ãƒƒãƒˆ"]].map(([k,l])=>
            <button key={k} onClick={()=>setFurniSort(k)} style={btn(furniSort===k)}>{l}</button>
          )}
          <span style={{flex:1}} />
          {!editMode ? <button onClick={enterEdit} style={{padding:"5px 12px",border:"none",borderRadius:6,background:C.accentDim,color:"#fff",fontSize:11,fontWeight:600,cursor:"pointer"}}>ğŸ“ ç·¨é›†</button>
          : <>{" "}<button onClick={saveEdit} style={{padding:"5px 12px",border:"none",borderRadius:6,background:"#66bb6a",color:"#000",fontSize:11,fontWeight:700,cursor:"pointer"}}>ğŸ’¾ ä¿å­˜</button>
            <button onClick={cancelEdit} style={{padding:"5px 12px",border:"none",borderRadius:6,background:C.danger,color:"#fff",fontSize:11,fontWeight:600,cursor:"pointer"}}>âœ• å–æ¶ˆ</button></>}
        </div>

        {filteredFurniture.map((f,i) => {
          const fs=gfs(f.id); const fn=eFurnName(f); const ft=eFurnTargets(f);
          const tNames=ft.map(sid=>eStudentName(allStudentMap[sid]||{name:sid})).join(", ");
          const series=eFurnSeries(f); const isCustom=f.id.startsWith("cf_");
          const showSeriesHeader = furniSort==="series" && (i===0 || eSeriesIdx(filteredFurniture[i-1])!==eSeriesIdx(f));
          const isEditing = editMode && editFurnId===f.id;
          return (<div key={f.id}>
            {showSeriesHeader && <div style={{fontSize:11,fontWeight:700,color:C.accent,padding:"6px 0 2px",borderBottom:`1px solid ${C.border}`,marginBottom:4}}>{series||"ãã®ä»–"}</div>}
            <div draggable={furniSort==="user"&&!isEditing} onDragStart={()=>onDS(f.id)} onDragOver={onDO} onDrop={()=>onDrop(f.id)} onDragEnd={onDE}
              style={{background:isEditing?"#2a3050":dragId===f.id?"#3a3c6a":C.card,borderRadius:8,padding:"7px 10px",marginBottom:3,border:`1px solid ${isEditing?"#ff9800":fs.owned?C.owned:C.border}`,cursor:furniSort==="user"&&!isEditing?"grab":"default",opacity:dragId===f.id?0.5:1}}>
              <div style={{display:"flex",alignItems:"center",gap:8}}>
                <span style={{fontSize:14,cursor:"pointer",userSelect:"none"}} onClick={()=>tfo(f.id)}>{fs.owned?"âœ…":"â¬œ"}</span>
                <div style={{flex:1,minWidth:0}}>
                  {!isEditing ? <>
                    <div style={{fontSize:12,fontWeight:600,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}}>{fn}</div>
                    <div style={{fontSize:10,color:C.textDim}}>
                      <span style={{background:f.cat==="decoration"?C.catDeco:C.catFurn,padding:"1px 4px",borderRadius:3,marginRight:3,color:"#fff",fontSize:9}}>{f.type}</span>
                      {series&&<span style={{padding:"1px 4px",borderRadius:3,marginRight:3,color:C.accent,fontSize:9,border:`1px solid ${C.accent}33`}}>{series}</span>}
                      {tNames}
                    </div>
                  </> : <div style={{display:"flex",flexDirection:"column",gap:3}}>
                    <div style={{display:"flex",gap:4,alignItems:"center"}}>
                      <span style={{fontSize:10,color:C.textDim,width:40}}>åå‰</span>
                      <input value={editDraft.name||""} onChange={e=>setEditDraft({...editDraft,name:e.target.value})} style={{flex:1,padding:"3px 6px",borderRadius:4,border:`1px solid ${C.border}`,background:C.bg,color:C.text,fontSize:11,outline:"none"}} />
                    </div>
                    <div style={{display:"flex",gap:4,alignItems:"center"}}>
                      <span style={{fontSize:10,color:C.textDim,width:40}}>ã‚·ãƒªãƒ¼ã‚º</span>
                      <input value={editDraft.series||""} onChange={e=>setEditDraft({...editDraft,series:e.target.value})} placeholder="(ãªã—)" style={{flex:1,padding:"3px 6px",borderRadius:4,border:`1px solid ${C.border}`,background:C.bg,color:C.text,fontSize:11,outline:"none"}} />
                    </div>
                    <div style={{display:"flex",gap:4,alignItems:"center"}}>
                      <span style={{fontSize:10,color:C.textDim,width:40}}>å¯¾è±¡</span>
                      <input value={editDraft.targets||""} onChange={e=>setEditDraft({...editDraft,targets:e.target.value})} placeholder="ç”Ÿå¾’å(ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Š)" style={{flex:1,padding:"3px 6px",borderRadius:4,border:`1px solid ${C.border}`,background:C.bg,color:C.text,fontSize:11,outline:"none"}} />
                    </div>
                    <div style={{display:"flex",gap:3,justifyContent:"flex-end"}}>
                      <button onClick={()=>applyEditFurn(f.id)} style={{padding:"3px 10px",border:"none",borderRadius:4,background:"#66bb6a",color:"#000",fontSize:10,fontWeight:700,cursor:"pointer"}}>é©ç”¨</button>
                      <button onClick={()=>setEditFurnId(null)} style={{padding:"3px 10px",border:"none",borderRadius:4,background:C.card,color:C.textDim,fontSize:10,cursor:"pointer"}}>é–‰ã˜ã‚‹</button>
                    </div>
                  </div>}
                </div>
                {editMode&&!isEditing&&<span onClick={()=>startEditFurn(f)} style={{cursor:"pointer",fontSize:11,color:"#ffb74d",padding:"2px 6px",borderRadius:4,border:"1px solid #ff980055"}}>âœï¸</span>}
                {isCustom&&<span onClick={()=>deleteCustomFurniture(f.id)} style={{cursor:"pointer",fontSize:12,color:C.danger}}>âœ•</span>}
                {fs.room>0&&<span style={{fontSize:9,padding:"2px 5px",borderRadius:4,background:roomColor(fs.room),color:"#fff",fontWeight:700}}>{roomLabel(fs.room)}</span>}
                {furniSort==="user"&&!isEditing&&<span style={{fontSize:14,color:C.textDim,cursor:"grab"}}>â ¿</span>}
              </div>
            </div>
          </div>);
        })}
      </div>}

      {/* ===== Tab 1: ãƒ«ãƒ¼ãƒ è¨­ç½® ===== */}
      {tab===1 && <div>
        <div style={{display:"flex",gap:4,marginBottom:6}}>
          <button onClick={()=>setRoomMode("room")} style={btn(roomMode==="room")}>ãƒ«ãƒ¼ãƒ è¡¨ç¤º</button>
          <button onClick={()=>setRoomMode("furniture")} style={btn(roomMode==="furniture")}>å®¶å…·è¡¨ç¤º</button>
        </div>
        <div style={{background:C.card,borderRadius:6,padding:"6px 10px",marginBottom:8,display:"flex",gap:6,alignItems:"center",flexWrap:"wrap"}}>
          <span style={{fontSize:10,color:C.gold,fontWeight:600}}>ğŸ…HL:</span>
          <span style={{fontSize:10,color:C.textDim}}>æ‰€æŒç”Ÿå¾’</span>
          {[["all","å…¨å“¡ãŒ"],["any","èª°ã‹ãŒ"]].map(([k,l])=>
            <button key={k} onClick={()=>setHlScope(k)} style={btn(hlScope===k,C.gold)}>{l}</button>
          )}
          <span style={{fontSize:10,color:C.textDim}}>çµ†</span>
          {[["cap","ä¸Šé™"],["ex920","EXæœ‰20/EXç„¡9"]].map(([k,l])=>
            <button key={k} onClick={()=>setHlThreshold(k)} style={btn(hlThreshold===k,C.gold)}>{l}</button>
          )}
          <span style={{fontSize:10,color:C.textDim}}>ã«é”æˆ</span>
        </div>

        {roomMode==="room" ? <div>
          {[1,2].map(rn => {
            const owned = allFurniture.filter(f=>gfs(f.id).owned&&roomSearchFilter(f));
            const inRoom = owned.filter(f=>isInRoom(gfs(f.id).room,rn));
            return <div key={rn} style={{marginBottom:20}}>
              <h3 style={{fontSize:15,color:rn===1?C.room1:C.room2,marginBottom:4}}>ãƒ«ãƒ¼ãƒ  {rn} <span style={{fontSize:11,fontWeight:400,color:C.textDim}}>({inRoom.length}å€‹)</span></h3>
              {owned.length===0&&<div style={{fontSize:12,color:C.textDim,padding:8}}>æ‰€æŒå®¶å…·ãªã—</div>}
              {owned.map(f => {
                const fs=gfs(f.id); const checked=isInRoom(fs.room,rn);
                const hl = furnHighlight(f);
                const tNames=eFurnTargets(f).map(sid=>{const ss=gss(sid);return allStudentMap[sid]?`${eStudentName(allStudentMap[sid])}(â˜…${ss.star} çµ†${ss.bond})`:"?";}).join(", ");
                return <div key={f.id} style={{background:hl?`${C.gold}22`:checked?`${roomColor(rn)}15`:C.card,borderRadius:8,padding:"5px 10px",marginBottom:2,border:`1px solid ${hl?C.gold:checked?roomColor(rn):C.border}`,boxShadow:hl?`0 0 6px ${C.gold}33`:"none"}}>
                  <label style={{display:"flex",alignItems:"center",gap:8,cursor:"pointer"}}>
                    <input type="checkbox" checked={checked} onChange={()=>toggleRoom(f.id,rn)} style={{accentColor:roomColor(rn),width:15,height:15}} />
                    <div style={{flex:1,minWidth:0}}>
                      <div style={{fontSize:11,fontWeight:600}}>{eFurnName(f)} {fs.room===3&&<span style={{fontSize:9,background:C.roomBoth,color:"#fff",padding:"1px 3px",borderRadius:3}}>ä¸¡æ–¹</span>}</div>
                      <div style={{fontSize:10,color:hl?C.gold:C.textDim}}>{tNames}</div>
                    </div>
                  </label>
                </div>;
              })}
            </div>;
          })}
        </div> : <div>
          {[1,2].map(rn => {
            const rf = allFurniture.filter(f=>isInRoom(gfs(f.id).room,rn)&&roomSearchFilter(f));
            return <div key={rn} style={{marginBottom:16}}>
              <h3 style={{fontSize:14,color:rn===1?C.room1:C.room2,marginBottom:6}}>ãƒ«ãƒ¼ãƒ  {rn} ({rf.length}å€‹)</h3>
              {rf.length===0&&<div style={{fontSize:12,color:C.textDim,padding:8}}>è¨­ç½®ãªã—</div>}
              {rf.map(f=><FurnRoomCard key={f.id} f={f} border={roomColor(rn)} showSelect />)}
            </div>;
          })}
          <h3 style={{fontSize:14,color:C.textDim,marginBottom:6}}>æœªè¨­ç½®(æ‰€æŒæ¸ˆã¿)</h3>
          {allFurniture.filter(f=>gfs(f.id).owned&&gfs(f.id).room===0&&roomSearchFilter(f)).map(f=><FurnRoomCard key={f.id} f={f} border={C.border} showSelect />)}
        </div>}
      </div>}

      {/* ===== Tab 2: çµ†ãƒ©ãƒ³ã‚¯ ===== */}
      {tab===2 && <div>
        <div style={{display:"flex",gap:3,marginBottom:4,flexWrap:"wrap",alignItems:"center"}}>
          {sortOpts.map(o=><button key={o.v} onClick={()=>setStudentSort(o.v)} style={btn(studentSort===o.v)}>{o.l}</button>)}
          <span style={{flex:1}} />
          {!editMode ? <button onClick={enterEdit} style={{padding:"5px 12px",border:"none",borderRadius:6,background:C.accentDim,color:"#fff",fontSize:11,fontWeight:600,cursor:"pointer"}}>ğŸ“ ç·¨é›†</button>
          : <>{" "}<button onClick={saveEdit} style={{padding:"5px 12px",border:"none",borderRadius:6,background:"#66bb6a",color:"#000",fontSize:11,fontWeight:700,cursor:"pointer"}}>ğŸ’¾ ä¿å­˜</button>
            <button onClick={cancelEdit} style={{padding:"5px 12px",border:"none",borderRadius:6,background:C.danger,color:"#fff",fontSize:11,fontWeight:600,cursor:"pointer"}}>âœ• å–æ¶ˆ</button></>}
        </div>
        <div style={{display:"flex",gap:3,marginBottom:4,flexWrap:"wrap"}}>
          <span style={{fontSize:10,color:C.textDim,lineHeight:"26px"}}>çµè¾¼:</span>
          {[["all","å…¨ã¦"],["owned","æ‰€æŒ"],["notOwned","æœªæ‰€æŒ"]].map(([k,l])=>
            <button key={k} onClick={()=>setBondFilter(k)} style={btn(bondFilter===k)}>{l}</button>
          )}
          <span style={{fontSize:10,color:C.textDim,lineHeight:"26px",marginLeft:6}}>å®¶å…·:</span>
          {[["all","å…¨ã¦"],["hasMotion","æœ‰"],["noMotion","ç„¡"]].map(([k,l])=>
            <button key={k} onClick={()=>setMotionFilter(k)} style={btn(motionFilter===k)}>{l}</button>
          )}
        </div>
        <div style={{fontSize:10,color:C.textDim,marginBottom:6,padding:"3px 8px",background:C.card,borderRadius:6,lineHeight:1.6}}>
          <span style={{color:C.amber}}>â– </span>EXç„¡&çµ†â‰¥9 <span style={{color:C.purple}}>â– </span>EXæœ‰&çµ†â‰¥20 <span style={{color:C.gold}}>â– </span>çµ†MAX â–¸EXã‚¿ãƒƒãƒ—åˆ‡æ›¿
        </div>

        {sortedStudents.map(s => {
          const ss=gss(s.id); const cap=getBondCap(ss.star); const isMax=ss.bond>=cap;
          const hasEx=ss.hasEx; const relFurn=allFurniture.filter(f=>eFurnTargets(f).includes(s.id));
          const hlA=!hasEx&&ss.bond>=9&&!isMax; const hlP=hasEx&&ss.bond>=20&&!isMax;
          const hlBg=isMax?`${C.gold}18`:hlP?`${C.purple}33`:hlA?`${C.amber}28`:C.card;
          const hlB=isMax?C.gold:hlP?C.purple:hlA?C.amber:C.border;
          const isCustom=s.id.startsWith("cs_");
          const sn=eStudentName(s);
          const isEditingS = editMode && editStudentId===s.id;
          return <div key={s.id} style={{background:isEditingS?"#2a3050":hlBg,borderRadius:8,padding:"7px 10px",marginBottom:3,border:`1px solid ${isEditingS?"#ff9800":hlB}`,boxShadow:isMax?`0 0 6px ${C.gold}33`:hlP||hlA?`0 0 6px ${hlB}33`:"none"}}>
            <div style={{display:"flex",alignItems:"center",gap:6}}>
              <span style={{fontSize:14,cursor:"pointer"}} onClick={()=>tso(s.id)}>{ss.owned?"âœ…":"â¬œ"}</span>
              <div style={{flex:1,minWidth:0}}>
                {!isEditingS ? <div style={{fontSize:12,fontWeight:600,display:"flex",alignItems:"center",flexWrap:"wrap",gap:3}}>
                  {sn} <span style={{fontSize:10,color:C.gold}}>{"â˜…".repeat(ss.star)}</span>
                  <span onClick={()=>tex(s.id)} style={{fontSize:9,padding:"1px 4px",borderRadius:4,fontWeight:700,cursor:"pointer",userSelect:"none",background:hasEx?"#ce93d8":"#555",color:hasEx?"#1a1a2e":"#999",border:hasEx?"1px solid #ce93d8":"1px dashed #777"}}>{hasEx?"EXæœ‰":"EXç„¡"}</span>
                  {hlA&&<span style={{fontSize:9,color:C.amber}}>âš çµ†{ss.bond}</span>}
                  {hlP&&<span style={{fontSize:9,color:C.purple}}>ğŸ’çµ†{ss.bond}</span>}
                  {isCustom&&<span onClick={()=>deleteCustomStudent(s.id)} style={{cursor:"pointer",fontSize:11,color:C.danger,marginLeft:4}}>âœ•å‰Šé™¤</span>}
                  {editMode&&<span onClick={()=>startEditStudent(s)} style={{cursor:"pointer",fontSize:11,color:"#ffb74d",marginLeft:2,padding:"1px 5px",borderRadius:4,border:"1px solid #ff980055"}}>âœï¸</span>}
                </div> : <div style={{display:"flex",gap:4,alignItems:"center",flexWrap:"wrap"}}>
                  <input value={editDraft.name||""} onChange={e=>setEditDraft({...editDraft,name:e.target.value})} style={{flex:1,minWidth:100,padding:"3px 6px",borderRadius:4,border:`1px solid ${C.border}`,background:C.bg,color:C.text,fontSize:11,outline:"none"}} />
                  <button onClick={()=>applyEditStudent(s.id)} style={{padding:"3px 8px",border:"none",borderRadius:4,background:"#66bb6a",color:"#000",fontSize:10,fontWeight:700,cursor:"pointer"}}>é©ç”¨</button>
                  <button onClick={()=>setEditStudentId(null)} style={{padding:"3px 8px",border:"none",borderRadius:4,background:C.card,color:C.textDim,fontSize:10,cursor:"pointer"}}>é–‰ã˜ã‚‹</button>
                </div>}
                <div style={{fontSize:10,color:C.textDim}}>{relFurn.map(f=>eFurnName(f)).join(", ")}</div>
              </div>
            </div>
            <div style={{display:"flex",alignItems:"center",gap:5,marginTop:5}}>
              <div style={{display:"flex",gap:1}}>{[1,2,3,4,5].map(n=><span key={n} onClick={()=>ssr(s.id,n)} style={{cursor:"pointer",fontSize:13,color:n<=ss.star?C.gold:C.textDim,userSelect:"none"}}>â˜…</span>)}</div>
              <span style={{fontSize:10,color:C.textDim}}>çµ†</span>
              <input type="range" min={1} max={cap} value={ss.bond} onChange={e=>ssb(s.id,Number(e.target.value))} style={{flex:1,accentColor:isMax?C.gold:C.accent}} />
              <input type="number" min={1} max={cap} value={ss.bond} onChange={e=>{const v=parseInt(e.target.value);if(!isNaN(v))ssb(s.id,v);}} style={{width:40,background:C.card,color:isMax?C.gold:C.text,border:`1px solid ${C.border}`,borderRadius:4,padding:"2px 4px",fontSize:11,textAlign:"right",outline:"none"}} />
              <span style={{fontSize:10,color:C.textDim}}>/{cap}</span>
            </div>
          </div>;
        })}
      </div>}

      {/* ===== Tab 3: ãƒ‡ãƒ¼ã‚¿ç®¡ç† ===== */}
      {tab===3 && <div style={{padding:8}}>
        <div style={{background:C.card,borderRadius:8,padding:12,marginBottom:10}}>
          <h3 style={{fontSize:14,marginBottom:6}}>ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿</h3>
          <div style={{fontSize:11,color:C.textDim,lineHeight:1.8}}>
            <div>ç”Ÿå¾’: {allStudents.length}å (â˜…3:{allStudents.filter(s=>s.star===3).length} â˜…2:{allStudents.filter(s=>s.star===2).length} â˜…1:{allStudents.filter(s=>s.star===1).length}) EXæœ‰:{allStudents.filter(s=>s.hasEx).length}å</div>
            <div>å®¶å…·: {allFurniture.length}å€‹ (å®¶å…·:{allFurniture.filter(f=>f.cat==="furniture").length} è£…é£¾:{allFurniture.filter(f=>f.cat==="decoration").length})</div>
            <div>ã‚«ã‚¹ã‚¿ãƒ : ç”Ÿå¾’{(state.customStudents||[]).length}å å®¶å…·{(state.customFurniture||[]).length}å€‹</div>
          </div>
        </div>

        {/* Add buttons */}
        <div style={{display:"flex",gap:6,marginBottom:10,flexWrap:"wrap"}}>
          <button onClick={()=>{setAddMode(addMode==="student"?null:"student");setAddForm({star:3});}} style={{padding:"7px 14px",border:"none",borderRadius:6,background:addMode==="student"?"#66bb6a":C.accentDim,color:"#fff",fontSize:12,fontWeight:600,cursor:"pointer"}}>+ ç”Ÿå¾’è¿½åŠ </button>
          <button onClick={()=>{setAddMode(addMode==="furniture"?null:"furniture");setAddForm({cat:"furniture",type:"å°ç‰©"});}} style={{padding:"7px 14px",border:"none",borderRadius:6,background:addMode==="furniture"?"#66bb6a":C.accentDim,color:"#fff",fontSize:12,fontWeight:600,cursor:"pointer"}}>+ å®¶å…·è¿½åŠ </button>
        </div>

        {addMode==="student" && <div style={{background:C.card,borderRadius:8,padding:12,marginBottom:10}}>
          <div style={{fontSize:12,fontWeight:600,marginBottom:6}}>ç”Ÿå¾’è¿½åŠ </div>
          <input placeholder="åå‰" value={addForm.name||""} onChange={e=>setAddForm({...addForm,name:e.target.value})} style={{width:"100%",boxSizing:"border-box",padding:"6px 8px",borderRadius:4,border:`1px solid ${C.border}`,background:C.bg,color:C.text,fontSize:12,marginBottom:4,outline:"none"}} />
          <div style={{display:"flex",gap:6,alignItems:"center",marginBottom:6}}>
            <span style={{fontSize:11,color:C.textDim}}>â˜…</span>
            <select value={addForm.star||3} onChange={e=>setAddForm({...addForm,star:Number(e.target.value)})} style={{background:C.bg,color:C.text,border:`1px solid ${C.border}`,borderRadius:4,padding:"4px 6px",fontSize:11}}>
              {[1,2,3].map(n=><option key={n} value={n}>â˜…{n}</option>)}
            </select>
            <label style={{fontSize:11,color:C.textDim,cursor:"pointer"}}><input type="checkbox" checked={!!addForm.hasEx} onChange={e=>setAddForm({...addForm,hasEx:e.target.checked})} /> EXæœ‰</label>
          </div>
          <button onClick={addCustomStudent} style={{padding:"6px 16px",border:"none",borderRadius:6,background:"#66bb6a",color:"#000",fontSize:12,fontWeight:600,cursor:"pointer"}}>è¿½åŠ </button>
        </div>}

        {addMode==="furniture" && <div style={{background:C.card,borderRadius:8,padding:12,marginBottom:10}}>
          <div style={{fontSize:12,fontWeight:600,marginBottom:6}}>å®¶å…·è¿½åŠ </div>
          <input placeholder="åå‰" value={addForm.name||""} onChange={e=>setAddForm({...addForm,name:e.target.value})} style={{width:"100%",boxSizing:"border-box",padding:"6px 8px",borderRadius:4,border:`1px solid ${C.border}`,background:C.bg,color:C.text,fontSize:12,marginBottom:4,outline:"none"}} />
          <div style={{display:"flex",gap:6,alignItems:"center",marginBottom:4,flexWrap:"wrap"}}>
            <select value={addForm.cat||"furniture"} onChange={e=>setAddForm({...addForm,cat:e.target.value})} style={{background:C.bg,color:C.text,border:`1px solid ${C.border}`,borderRadius:4,padding:"4px",fontSize:11}}>
              <option value="furniture">å®¶å…·</option><option value="decoration">è£…é£¾</option>
            </select>
            <select value={addForm.type||"å°ç‰©"} onChange={e=>setAddForm({...addForm,type:e.target.value})} style={{background:C.bg,color:C.text,border:`1px solid ${C.border}`,borderRadius:4,padding:"4px",fontSize:11}}>
              {FURN_TYPES.map(t=><option key={t} value={t}>{t}</option>)}
            </select>
          </div>
          <input placeholder="å¯¾è±¡ç”Ÿå¾’å(ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Š)" value={addForm.targets||""} onChange={e=>setAddForm({...addForm,targets:e.target.value})} style={{width:"100%",boxSizing:"border-box",padding:"6px 8px",borderRadius:4,border:`1px solid ${C.border}`,background:C.bg,color:C.text,fontSize:11,marginBottom:6,outline:"none"}} />
          <button onClick={addCustomFurniture} style={{padding:"6px 16px",border:"none",borderRadius:6,background:"#66bb6a",color:"#000",fontSize:12,fontWeight:600,cursor:"pointer"}}>è¿½åŠ </button>
        </div>}

        <div style={{display:"flex",gap:6,flexWrap:"wrap",marginBottom:10}}>
          <button onClick={()=>{setShowIO(!showIO);setImportText("");}} style={{padding:"7px 14px",border:"none",borderRadius:6,background:C.accent,color:"#000",fontSize:12,fontWeight:600,cursor:"pointer"}}>{showIO?"é–‰ã˜ã‚‹":"ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ/ã‚¤ãƒ³ãƒãƒ¼ãƒˆ"}</button>
          {!confirmReset?<button onClick={()=>setConfirmReset(true)} style={{padding:"7px 14px",border:"none",borderRadius:6,background:C.danger,color:"#fff",fontSize:12,fontWeight:600,cursor:"pointer"}}>å…¨ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆ</button>
          :<div style={{display:"flex",gap:4,alignItems:"center"}}><span style={{fontSize:11,color:C.danger,fontWeight:700}}>æœ¬å½“ã«ï¼Ÿ</span>
            <button onClick={doReset} style={{padding:"5px 12px",border:"none",borderRadius:6,background:C.danger,color:"#fff",fontSize:11,fontWeight:700,cursor:"pointer"}}>å®Ÿè¡Œ</button>
            <button onClick={()=>setConfirmReset(false)} style={{padding:"5px 12px",border:"none",borderRadius:6,background:C.card,color:C.textDim,fontSize:11,cursor:"pointer"}}>å–æ¶ˆ</button>
          </div>}
        </div>

        {showIO && <div style={{background:C.card,borderRadius:8,padding:12}}>
          <div style={{fontSize:12,color:C.accent,fontWeight:600,marginBottom:4}}>ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</div>
          <textarea readOnly value={exportJson} onFocus={e=>e.target.select()} style={{background:"#1e1e38",border:`1px solid ${C.border}`,borderRadius:6,color:"#81c784",padding:6,fontFamily:"monospace",fontSize:10,outline:"none",width:"100%",minHeight:50,resize:"vertical",boxSizing:"border-box",marginBottom:8}} />
          <div style={{fontSize:12,color:C.amber,fontWeight:600,marginBottom:4}}>ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</div>
          <textarea value={importText} onChange={e=>setImportText(e.target.value)} placeholder="JSONè²¼ã‚Šä»˜ã‘..." style={{background:"#1e1e38",border:`1px solid ${C.border}`,borderRadius:6,color:C.text,padding:6,fontFamily:"monospace",fontSize:10,outline:"none",width:"100%",minHeight:50,resize:"vertical",boxSizing:"border-box",marginBottom:6}} />
          <button onClick={doImport} style={{padding:"7px 14px",border:"none",borderRadius:6,background:"#66bb6a",color:"#000",fontSize:12,fontWeight:600,cursor:"pointer"}}>ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Ÿè¡Œ</button>
        </div>}
      </div>}
    </div>
  );
}

const root = ReactDOM.createRoot(document.getElementById("root"));
root.render(<App />);
  </script>
</body>
</html>
